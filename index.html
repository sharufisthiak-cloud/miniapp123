// Константа с адресом твоего будущего сервера
const SERVER_URL = "https://your-api-tale-stars.com";

// 1. ФУНКЦИЯ ЗАПРОСА КЛЮЧА
async function generateKey() {
    const user = window.Telegram.WebApp.initDataUnsafe.user; // Берем данные юзера из ТГ
    
    try {
        const response = await fetch(`${SERVER_URL}/get-new-key`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ 
                user_id: user.id,
                username: user.username 
            })
        });
        
        const data = await response.json();
        
        // Показываем ключ, который прислал сервер
        const keyBox = document.getElementById('keyBox');
        keyBox.innerText = data.key; 
        keyBox.style.display = 'block';
        
    } catch (e) {
        alert("Ошибка связи с сервером Tale Stars");
    }
}

// 2. ФУНКЦИЯ АКТИВАЦИИ
async function activateKey() {
    const keyVal = document.getElementById('keyInput').value;
    const user = window.Telegram.WebApp.initDataUnsafe.user;

    const response = await fetch(`${SERVER_URL}/activate`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ 
            key: keyVal,
            user_id: user.id 
        })
    });

    const result = await response.json();
    if (result.success) {
        alert("Ключ привязан! Теперь он работает в игре.");
    } else {
        alert("Ошибка: " + result.message);
    }
}
